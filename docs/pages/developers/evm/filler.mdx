# Filler Package

A TypeScript package for automatically filling orders on the Hyperbridge IntentGateway contract. Monitors multiple chains for orders and fills them based on configurable strategies.

## Quick Start

```typescript
import { IntentFiller, BasicFiller, ConfirmationPolicy } from "@polytope-labs/hyperbridge-filler"
import { ChainConfigService } from "@hyperbridge/sdk"

// 1. Get chain configs
const configService = new ChainConfigService()
const chainConfigs = ["EVM-97", "EVM-10200"].map((id) => configService.getChainConfig(id))

// 2. Set up confirmation policy
const confirmationPolicy = new ConfirmationPolicy({
	"97": {
		minAmount: "1000000000000000000",
		maxAmount: "1000000000000000000000",
		minConfirmations: 1,
		maxConfirmations: 5,
	},
	"10200": {
		minAmount: "1000000000000000000",
		maxAmount: "1000000000000000000000",
		minConfirmations: 1,
		maxConfirmations: 5,
	},
})

// 3. Create filler with your private key
const filler = new IntentFiller(
	chainConfigs,
	[new BasicFiller("0x...")], // Your private key
	{
		maxConcurrentOrders: 5,
		confirmationPolicy: {
			getConfirmationBlocks: (chainId, amount) => confirmationPolicy.getConfirmationBlocks(chainId, amount),
		},
	},
)

// 4. Start filling orders
filler.start()

// Listen for events
filler.monitor.on("newOrder", ({ order }) => {
	console.log("New order:", order.id)
})

filler.monitor.on("orderFilled", ({ orderId, hash }) => {
	console.log("Order filled:", orderId, hash)
})
```

## How It Works

The filler automatically:

1. **Monitors** multiple chains for `OrderPlaced` events
2. **Waits** for required confirmations based on order value
3. **Evaluates** orders using your strategies (profitability, eligibility)
4. **Fills** profitable orders using chain-specific queues

## Built-in Strategy

### BasicFiller

- Validates order inputs/outputs match
- Checks token balances
- Calculates profitability (fees vs gas costs)
- Executes fills with proper approvals

```typescript
const strategy = new BasicFiller("0x...") // Your private key
```

## Custom Strategy

```typescript
import { FillerStrategy } from "@polytope-labs/hyperbridge-filler"

class MyStrategy implements FillerStrategy {
	name = "MyStrategy"

	async canFill(order: Order): Promise<boolean> {
		// Return true if order is eligible
		return true
	}

	async calculateProfitability(order: Order): Promise<bigint> {
		// Return profit amount (0 if not profitable)
		return 1000000n
	}

	async executeOrder(order: Order): Promise<ExecutionResult> {
		// Fill the order and return result
		return { success: true, txHash: "0x..." }
	}
}
```

## Configuration

### Confirmation Policy

Higher value orders require more confirmations for security:

```typescript
const policy = new ConfirmationPolicy({
	"1": {
		// Ethereum mainnet
		minAmount: "1000000000000000000", // 1 ETH
		maxAmount: "100000000000000000000", // 100 ETH
		minConfirmations: 12,
		maxConfirmations: 30,
	},
	"97": {
		// BSC testnet
		minAmount: "1000000000000000000",
		maxAmount: "1000000000000000000000",
		minConfirmations: 1,
		maxConfirmations: 5,
	},
})
```

### Filler Config

```typescript
const config = {
	maxConcurrentOrders: 5, // Max orders processed simultaneously
	confirmationPolicy: {
		getConfirmationBlocks: (chainId, amount) => policy.getConfirmationBlocks(chainId, amount),
	},
	pendingQueueConfig: {
		maxRechecks: 10,
		recheckDelayMs: 30000,
	},
}
```

## Events

```typescript
// New order detected
filler.monitor.on("newOrder", ({ order }) => {
	console.log("Order:", order.id, order.sourceChain, "â†’", order.destChain)
})

// Order successfully filled
filler.monitor.on("orderFilled", ({ orderId, hash }) => {
	console.log("Filled:", orderId, hash)
})
```

## Key Features

- **Multi-chain support**: Monitor and fill across multiple EVM chains
- **Strategy-based**: Implement custom logic for order evaluation
- **Queue management**: Chain-specific queues prevent transaction conflicts
- **Dynamic confirmations**: Security scales with order value
- **Event-driven**: Real-time order monitoring and processing
- **Built-in strategies**: Ready-to-use BasicFiller for common use cases

## Environment Variables

Create a `.env` file with the following variables:

````bash
# Your private key (required)
PRIVATE_KEY=0x...

# RPC endpoints for chains you want to monitor
- `BASE_MAINNET` - Base mainnet RPC URL
- `ARBITRUM_MAINNET` - Arbitrum mainnet RPC URL
- `BSC_MAINNET` - BSC mainnet RPC URL
- `ETH_MAINNET` - Ethereum mainnet RPC URL

## Requirements

- Private key with funds for gas fees
- RPC endpoints for target chains
- Sufficient token balances for fills
- Environment variables configured

## Installation

```bash
npm install @polytope-labs/hyperbridge-filler
````
